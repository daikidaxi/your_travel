<html lang="ja">
  <style>
    #maps{ height: 600px;
           width:  100%; }
  </style>
  <div class="container mx-auto" style="width: 1000px;">
    <div id="maps"></div>
  </div>
  <script src="//maps.googleapis.com/maps/api/js?key=<%=ENV['GOOGLE_MAP_API']%>&callback=initMap&language=ja&libraries=places" async></script>
  <script>
    function initMap() {
      <% if @latest_post.present?%>
        var mapCenter = {lat: <%=@latest_post.latitude%>,lng: <%=@latest_post.longitude%>};
      <% elsif %>
        var mapCenter = {lat: <%=@posts.first.latitude%>,lng: <%=@posts.first.longitude%>};
      <% end %>
      var mapArea = document.getElementById('maps');
      var mapOptions = {
        center: mapCenter,
        zoom: 2,
        mapTypeControl: false,
        fullscreenControl: false,
        streetViewControl: false,
        zoomControl: true
      }
      var map = new google.maps.Map(mapArea, mapOptions);
      <% if @posts.any?%>
        <% @posts.each do |post|%>
          var newPosition ={lat: <%=post.latitude%>,lng: <%=post.longitude%>}
          var markerOthers = {
            map: map,
            position: newPosition,
            icon: 'https://maps.google.com/mapfiles/ms/micons/red-dot.png',
          };
          var marker = new google.maps.Marker(markerOthers);
        <% end %>
      <% end %>

      var markerOptions = {
        map: map,
        position: mapCenter,
        icon: 'https://maps.google.com/mapfiles/ms/micons/blue-dot.png',
      };
      var latest_marker = new google.maps.Marker(markerOptions);

      }
  </script>